<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Taylor Arnold and Lauren Tilton">

<title>17&nbsp; JSON + XML – Humanities Data in Python</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./18_databases.html" rel="next">
<link href="./16_program.html" rel="prev">
<link href="./owl_explore.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-7dd7401653f9b7f7a674e3bd3661a20e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./16_program.html">Part IV: Programming</a></li><li class="breadcrumb-item"><a href="./17_jsonxml.html"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">JSON + XML</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Humanities Data in Python</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/distant-viewing/hdpy" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Part I: Core</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">EDA I: Visualizing Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_verbs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">EDA II: Organizing Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_combine.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">EDA III: Restructuring Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_collect.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Collecting Data</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Part II: Data Types</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_textual_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Textual Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_network_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Network Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_temporal_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Temporal Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09_spatial_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Spatial Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_image_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Image Data</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Part III: Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Inference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_supervised.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Supervised Learning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_unsupervised.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Unsupervised Learning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_deeplearning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Deep Learning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15_transformers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Transformers</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Part IV: Programming</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16_program.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17_jsonxml.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">JSON + XML</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18_databases.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Databases</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">17.1</span> Introduction</a></li>
  <li><a href="#strings" id="toc-strings" class="nav-link" data-scroll-target="#strings"><span class="header-section-number">17.2</span> Strings</a></li>
  <li><a href="#regular-expressions" id="toc-regular-expressions" class="nav-link" data-scroll-target="#regular-expressions"><span class="header-section-number">17.3</span> Regular Expressions</a></li>
  <li><a href="#json-data" id="toc-json-data" class="nav-link" data-scroll-target="#json-data"><span class="header-section-number">17.4</span> JSON Data</a></li>
  <li><a href="#xml-and-html-formats" id="toc-xml-and-html-formats" class="nav-link" data-scroll-target="#xml-and-html-formats"><span class="header-section-number">17.5</span> XML and HTML Formats</a></li>
  <li><a href="#xpath-with-lxml" id="toc-xpath-with-lxml" class="nav-link" data-scroll-target="#xpath-with-lxml"><span class="header-section-number">17.6</span> XPath with lxml</a></li>
  <li><a href="#using-an-api" id="toc-using-an-api" class="nav-link" data-scroll-target="#using-an-api"><span class="header-section-number">17.7</span> Using an API</a></li>
  <li><a href="#extensions" id="toc-extensions" class="nav-link" data-scroll-target="#extensions"><span class="header-section-number">17.8</span> Extensions</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./16_program.html">Part IV: Programming</a></li><li class="breadcrumb-item"><a href="./17_jsonxml.html"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">JSON + XML</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-ch17" class="quarto-section-identifier"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">JSON + XML</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level2" data-number="17.1">
<h2 data-number="17.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">17.1</span> Introduction</h2>
<p>In this text we have primarily worked with tabular data stored in a CSV file. Tabular data is arranged into rows and columns, which we went into further detail in Chap. 5. As we have seen, this format is surprisingly flexible while also keeping the data organized in a way that is optimized for using the grammar of graphics and data manipulation verbs to do exploratory data analysis. Getting data organized for analysis often takes significant time. In fact, it often takes us more time than the analysis. Whether creating our own data or moving between formats, collecting and organizing data is a time consuming, yet key, task.</p>
<p>There are many other formats available for storing tabular datasets. We mentioned the use of the Excel format in Chap. 5 as a good option for data entry and we used the special GeoJSON format for storing tabular data along with geospatial information. For most other common tabular data formats there is likely to be at least one Python function or package that is able to read, and in most cases write, tabular data stored in it. The <strong>pandas</strong> library can load many variations on CSV, such as tables that use other delimiters or fixed-width columns. The <strong>geopandas</strong> library that we used for GeoJSON will automatically read many other spatial formats such as ESRI shapefiles. For formats created by SAS, SPSS, or Stata, pandas has functions for getting the data into Python DataFrames <span class="citation" data-cites="haven">[<a href="#ref-haven" role="doc-biblioref">1</a>]</span>. If we have one or more data tables in a database, packages such as <strong>sqlalchemy</strong> and database-specific libraries can query the database and return tables as pandas DataFrames <span class="citation" data-cites="duckdb">[<a href="#ref-duckdb" role="doc-biblioref">2</a>]</span> <span class="citation" data-cites="RMySQL">[<a href="#ref-RMySQL" role="doc-biblioref">3</a>]</span>. For other tabular data files that we may run into, searching Python’s package index (PyPI) will usually reveal a package that can help get data into the desired format.</p>
<p>Sometimes, data will be available in a format that is not initially organized into the kinds of tables we introduced in Chap. 1 and have used throughout this book. The most common types of non-tabular data that we may run into include raw text, JSON (Javascript Object Notation), XML (Extensible Markup Language), and HTML (HyperText Markup Language). All of these can be loaded into Python using built-in functions and packages specifically designed to parse them. The challenge, however, is that when read into Python these formats will be in the form of dictionaries, lists, or other custom objects. Parsing these formats into a DataFrame requires writing custom code that takes into account the specific information stored in the data. Often this requires using new functions or query languages, such as regular expressions or XPath queries, to facilitate the conversion process. In this chapter, we will introduce these four common formats and show examples of how they can be used to represent different kinds of information. Along the way, we show specific functions for parsing data stored in these file types.</p>
</section>
<section id="strings" class="level2" data-number="17.2">
<h2 data-number="17.2" class="anchored" data-anchor-id="strings"><span class="header-section-number">17.2</span> Strings</h2>
<p>The term <em>string</em> typically refers to a sequence of characters. We have been using variables of string type throughout this book. We have used string variables in several different ways. First, as in Chaps. 2-5, as categories to group, filter, and summarize a dataset. There we treated the string variables as coming from a fixed set of values (such as the name of a region of the United States). In Chap. 5, we noted that when creating data it is important to document and use a consistent set of codes in order facilitate this kind of usage. Another way that we have used strings are as labels or ids. Here, typically, we expect each row of a dataset to have a unique value for a specific variable and we use this value to label points in a graphic. We used this approach in Chap. 2 in connection with geom_text layers and to link together datasets through joins in Chap. 4. Identifiers also were used through the application chapters to identify each document in a textual corpus, nodes in the network data, and the images in our image dataset. In the latter case, strings were also used to indicate the file path where the actual images could be found on our local machine. Another usage of strings came from the application in Chap. 6, where each string recorded long, free-form text that constituted the main object of study in that chapter. We saw that working with the latter required first pre-processing the data through an NLP pipeline to create an annotation table with one row per token.</p>
<p>The case we consider here is where strings fall somewhere in-between the free-form text in Chap. 6 and the structured categories in the opening chapters. In other words, each string might contain structured data that needs to be modified before we can use it in data summaries, visualizations, and models. Understanding how to parse apart raw strings is a key step in learning how to collect and organize large datasets. In this and the following section, we will share several techniques for manipulating strings that we will be able to put to use in cleaning data in the subsequent chapters.</p>
<p>To illustrate the string manipulation functions presented here, we will again use a dataset created from Wikipedia related to British authors. In the previous examples, we used a relatively small set of 75 authors. Each of the authors was associated with several metadata categories such as the years of birth and death and a category describing the era in which they were active. We created those records manually using the data entry methods described in Chap. 5. The metadata were stored as a CSV file that we then read into Python and then joined with the dataset that had the textual documents. Wikipedia has a much larger list of authors that we could use to create a much larger set of pages. As we will see below, creating the documents for this larger set is relatively straightforward and just involves a longer loop through the set of pages. Grabbing the metadata for each author, however, is a bit more challenging because we want to try to do this automatically rather than entering the thousands of records manually.</p>
<p>We have saved one of the intermediate steps in grabbing the larger set of Wikipedia pages as a text file, with one row for each author. (We will show later how to generate this file.) We can load this dataset into Python by reading the file line by line:</p>
<div id="f468edab" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read lines from file</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"data/wiki_uk_long_meta.txt"</span>, <span class="st">"r"</span>, encoding<span class="op">=</span><span class="st">"utf-8"</span>) <span class="im">as</span> f:</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    wiki <span class="op">=</span> f.read().strip().split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Show first 10 lines</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>wiki[i]<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0: A. W. (fl. 1602), poet
1: Edwin Abbott Abbott (1838-1926), theologian and novelist
2: Gilbert Abbott à Beckett (1811-1856), humorist
3: George Abbot (1562-1633), writer, AV translator and cleric
4: Kia Abdullah (born 1982), novelist and feature writer
5: Lascelles Abercrombie (1881-1938), poet and critic
6: Faridah Àbíké-Íyímídé (born 1998), novelist
7: Paul Ableman (1927-2006), playwright and novelist
8: J. R. Ackerley (1896-1967), autobiographer, novelist and playwright
9: Rodney Ackland (1908-1991), playwright, actor and screenwriter</code></pre>
</div>
</div>
<p>Already we see that there is quite a lot of interesting metadata in this list. However, it is not sufficiently structured to immediately turn it into a tabular dataset with all of the features as individual columns. As a first step, we will create a DataFrame that contains the text as its single column:</p>
<div id="328dfec3" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>wiki_df <span class="op">=</span> pd.DataFrame({<span class="st">'desc'</span>: wiki})</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>wiki_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">desc</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>A. W. (fl. 1602), poet</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Edwin Abbott Abbott (1838-1926), theologian an...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Gilbert Abbott à Beckett (1811-1856), humorist</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>George Abbot (1562-1633), writer, AV translato...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Kia Abdullah (born 1982), novelist and feature...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4231</td>
<td>Benjamin Zephaniah (born 1958), dub poet</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4232</td>
<td>Philip Ziegler (1929-2023), biographer and his...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4233</td>
<td>Alfred Eckhard Zimmern (1879-1957), classicist...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4234</td>
<td>Alice Zimmern (1855-1939), writer and translator</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4235</td>
<td>Helen Zimmern (1846-1934), writer and translator</td>
</tr>
</tbody>
</table>

<p>4236 rows × 1 columns</p>
</div>
</div>
</div>
<p>In order to extract the structured information from this text, we need to use specific functions for working with strings. Python has excellent built-in string methods and the <strong>re</strong> module for regular expressions. All string objects in Python have many useful methods. For example, we can find the length of each string:</p>
<div id="e4a381f0" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add string length column</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>wiki_df[<span class="st">'desc_len'</span>] <span class="op">=</span> wiki_df[<span class="st">'desc'</span>].<span class="bu">str</span>.<span class="bu">len</span>()</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>wiki_df[[<span class="st">'desc'</span>, <span class="st">'desc_len'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">desc</th>
<th data-quarto-table-cell-role="th">desc_len</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>A. W. (fl. 1602), poet</td>
<td>22</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Edwin Abbott Abbott (1838-1926), theologian an...</td>
<td>56</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Gilbert Abbott à Beckett (1811-1856), humorist</td>
<td>46</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>George Abbot (1562-1633), writer, AV translato...</td>
<td>58</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Kia Abdullah (born 1982), novelist and feature...</td>
<td>53</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4231</td>
<td>Benjamin Zephaniah (born 1958), dub poet</td>
<td>40</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4232</td>
<td>Philip Ziegler (1929-2023), biographer and his...</td>
<td>52</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4233</td>
<td>Alfred Eckhard Zimmern (1879-1957), classicist...</td>
<td>60</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4234</td>
<td>Alice Zimmern (1855-1939), writer and translator</td>
<td>48</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4235</td>
<td>Helen Zimmern (1846-1934), writer and translator</td>
<td>48</td>
</tr>
</tbody>
</table>

<p>4236 rows × 2 columns</p>
</div>
</div>
</div>
<p>There are also methods to extract substrings. Python uses zero-based indexing, so the first character is at position 0. We can extract substrings using slice notation:</p>
<div id="bcee6ab4" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract first three characters</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>wiki_df[<span class="st">'desc_first_three'</span>] <span class="op">=</span> wiki_df[<span class="st">'desc'</span>].<span class="bu">str</span>[:<span class="dv">3</span>]</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>wiki_df[[<span class="st">'desc'</span>, <span class="st">'desc_first_three'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">desc</th>
<th data-quarto-table-cell-role="th">desc_first_three</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>A. W. (fl. 1602), poet</td>
<td>A.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Edwin Abbott Abbott (1838-1926), theologian an...</td>
<td>Edw</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Gilbert Abbott à Beckett (1811-1856), humorist</td>
<td>Gil</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>George Abbot (1562-1633), writer, AV translato...</td>
<td>Geo</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Kia Abdullah (born 1982), novelist and feature...</td>
<td>Kia</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4231</td>
<td>Benjamin Zephaniah (born 1958), dub poet</td>
<td>Ben</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4232</td>
<td>Philip Ziegler (1929-2023), biographer and his...</td>
<td>Phi</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4233</td>
<td>Alfred Eckhard Zimmern (1879-1957), classicist...</td>
<td>Alf</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4234</td>
<td>Alice Zimmern (1855-1939), writer and translator</td>
<td>Ali</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4235</td>
<td>Helen Zimmern (1846-1934), writer and translator</td>
<td>Hel</td>
</tr>
</tbody>
</table>

<p>4236 rows × 2 columns</p>
</div>
</div>
</div>
<p>We can also extract from the end of strings using negative indices:</p>
<div id="db534d9d" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract last three characters</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>wiki_df[<span class="st">'desc_last_three'</span>] <span class="op">=</span> wiki_df[<span class="st">'desc'</span>].<span class="bu">str</span>[<span class="op">-</span><span class="dv">3</span>:]</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>wiki_df[[<span class="st">'desc_last_three'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">desc_last_three</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>oet</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>ist</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>ist</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>ric</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>ter</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4231</td>
<td>oet</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4232</td>
<td>ian</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4233</td>
<td>ian</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4234</td>
<td>tor</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4235</td>
<td>tor</td>
</tr>
</tbody>
</table>

<p>4236 rows × 1 columns</p>
</div>
</div>
</div>
<p>There are many other useful string methods for searching and replacing:</p>
<div id="05a6a5d0" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if strings contain specific text</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>wiki_df[<span class="st">'has_and'</span>] <span class="op">=</span> wiki_df[<span class="st">'desc'</span>].<span class="bu">str</span>.contains(<span class="st">'and'</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Count occurrences</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>wiki_df[<span class="st">'count_and'</span>] <span class="op">=</span> wiki_df[<span class="st">'desc'</span>].<span class="bu">str</span>.count(<span class="st">'and'</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace text</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>wiki_df[<span class="st">'desc_replaced'</span>] <span class="op">=</span> wiki_df[<span class="st">'desc'</span>].<span class="bu">str</span>.replace(<span class="st">'ï'</span>, <span class="st">'o'</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>wiki_df[[<span class="st">'has_and'</span>, <span class="st">'count_and'</span>, <span class="st">'desc_replaced'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">has_and</th>
<th data-quarto-table-cell-role="th">count_and</th>
<th data-quarto-table-cell-role="th">desc_replaced</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>False</td>
<td>0</td>
<td>A. W. (fl. 1602), poet</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>True</td>
<td>1</td>
<td>Edwin Abbott Abbott (1838-1926), theologian an...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>False</td>
<td>0</td>
<td>Gilbert Abbott à Beckett (1811-1856), humorist</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>True</td>
<td>1</td>
<td>George Abbot (1562-1633), writer, AV translato...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>True</td>
<td>1</td>
<td>Kia Abdullah (born 1982), novelist and feature...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4231</td>
<td>False</td>
<td>0</td>
<td>Benjamin Zephaniah (born 1958), dub poet</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4232</td>
<td>True</td>
<td>1</td>
<td>Philip Ziegler (1929-2023), biographer and his...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4233</td>
<td>True</td>
<td>1</td>
<td>Alfred Eckhard Zimmern (1879-1957), classicist...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4234</td>
<td>True</td>
<td>1</td>
<td>Alice Zimmern (1855-1939), writer and translator</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4235</td>
<td>True</td>
<td>1</td>
<td>Helen Zimmern (1846-1934), writer and translator</td>
</tr>
</tbody>
</table>

<p>4236 rows × 3 columns</p>
</div>
</div>
</div>
<p>These basic string methods are great building blocks for extracting text. However, we need a more flexible approach to parse the Wikipedia data in our example.</p>
</section>
<section id="regular-expressions" class="level2" data-number="17.3">
<h2 data-number="17.3" class="anchored" data-anchor-id="regular-expressions"><span class="header-section-number">17.3</span> Regular Expressions</h2>
<p>Python’s <strong>re</strong> module provides powerful regular expression capabilities. A <em>regular expression</em> is a way of describing patterns in strings. The language of regular expressions can become quite complex; here we will focus on a subset of components that are more frequently used for cleaning data.</p>
<div id="30e1a171" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's work with a sample of our data</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>sample_desc <span class="op">=</span> wiki_df[<span class="st">'desc'</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>sample_desc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>'A. W. (fl. 1602), poet'</code></pre>
</div>
</div>
<p>There are several special commands in a regular expression that stand for sets of characters. A period <code>.</code> stands for any character, <code>\w</code> for word characters (letters and numbers), and <code>\W</code> for non-word characters such as spaces. Putting any sequence of characters in square brackets will search for any matching character in the set. If the first term in the brackets is the caret <code>^</code>, this will instead match anything not in the set. There is also a special shorthand, <code>[0-9]</code>, to match any digit. If we want to match one or more consecutive characters, we can use the plus sign (<code>+</code>). Let’s see examples:</p>
<div id="07746b15" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract patterns using pandas string methods with regex</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>wiki_sample <span class="op">=</span> wiki_df.head(<span class="dv">10</span>).copy()</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract first word character</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>wiki_sample[<span class="st">'first_word_char'</span>] <span class="op">=</span> wiki_sample[<span class="st">'desc'</span>].<span class="bu">str</span>.extract(<span class="vs">r'</span><span class="kw">(</span><span class="dv">\w</span><span class="kw">)</span><span class="vs">'</span>, expand<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract first sequence of word characters</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>wiki_sample[<span class="st">'first_word'</span>] <span class="op">=</span> wiki_sample[<span class="st">'desc'</span>].<span class="bu">str</span>.extract(<span class="vs">r'</span><span class="kw">(</span><span class="dv">\w</span><span class="op">+</span><span class="kw">)</span><span class="vs">'</span>, expand<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract first sequence of digits</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>wiki_sample[<span class="st">'first_numbers'</span>] <span class="op">=</span> wiki_sample[<span class="st">'desc'</span>].<span class="bu">str</span>.extract(<span class="vs">r'</span><span class="kw">(</span><span class="pp">[0-9]</span><span class="op">+</span><span class="kw">)</span><span class="vs">'</span>, expand<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract first sequence of vowels</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>wiki_sample[<span class="st">'first_vowels'</span>] <span class="op">=</span> wiki_sample[<span class="st">'desc'</span>].<span class="bu">str</span>.extract(<span class="vs">r'</span><span class="kw">(</span><span class="pp">[aeiou]</span><span class="op">+</span><span class="kw">)</span><span class="vs">'</span>, expand<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>wiki_sample[[<span class="st">'first_word'</span>, <span class="st">'first_numbers'</span>, <span class="st">'first_vowels'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">first_word</th>
<th data-quarto-table-cell-role="th">first_numbers</th>
<th data-quarto-table-cell-role="th">first_vowels</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>A</td>
<td>1602</td>
<td>oe</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Edwin</td>
<td>1838</td>
<td>i</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Gilbert</td>
<td>1811</td>
<td>i</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>George</td>
<td>1562</td>
<td>eo</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Kia</td>
<td>1982</td>
<td>ia</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Lascelles</td>
<td>1881</td>
<td>a</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Faridah</td>
<td>1998</td>
<td>a</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Paul</td>
<td>1927</td>
<td>au</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>J</td>
<td>1896</td>
<td>e</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>Rodney</td>
<td>1908</td>
<td>o</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Two other special regular expression characters are <code>^</code> (start of string) and <code>$</code> (end of string). These are called <em>anchors</em> and can be very useful for grabbing data within a string.</p>
<p>Now, we have enough tools to try to extract some of the data that is captured inside of the string. To start, at least in the first ten rows, if we extract all of the text up to the parenthesis, we will have the full name of each author. We can do this by finding text that doesn’t include parentheses:</p>
<div id="1eb1dac5" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>wiki_sample[<span class="st">'author_name'</span>] <span class="op">=</span> wiki_sample[<span class="st">'desc'</span>].<span class="bu">str</span>.extract(<span class="vs">r'</span><span class="kw">(</span><span class="pp">[^(]</span><span class="op">+</span><span class="kw">)</span><span class="vs">'</span>, expand<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>wiki_sample[<span class="st">'author_name'</span>] <span class="op">=</span> wiki_sample[<span class="st">'author_name'</span>].<span class="bu">str</span>.strip()</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>wiki_sample[[<span class="st">'author_name'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">author_name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>A. W.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Edwin Abbott Abbott</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Gilbert Abbott à Beckett</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>George Abbot</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Kia Abdullah</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Lascelles Abercrombie</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Faridah Àbíké-Íyímídé</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Paul Ableman</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>J. R. Ackerley</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>Rodney Ackland</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>What if we wanted to extract the last name of each author? This could be useful to create a short name for future plots. We can do this by finding word characters at the end of the author name:</p>
<div id="1f347bcc" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract last names (last word before parentheses)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>wiki_sample[<span class="st">'last_name'</span>] <span class="op">=</span> wiki_sample[<span class="st">'author_name'</span>].<span class="bu">str</span>.extract(<span class="vs">r'</span><span class="kw">(</span><span class="pp">[</span><span class="dv">\w</span><span class="pp">.]</span><span class="op">+</span><span class="kw">)</span><span class="dv">$</span><span class="vs">'</span>, expand<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>wiki_sample[[<span class="st">'author_name'</span>, <span class="st">'last_name'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">author_name</th>
<th data-quarto-table-cell-role="th">last_name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>A. W.</td>
<td>W.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Edwin Abbott Abbott</td>
<td>Abbott</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Gilbert Abbott à Beckett</td>
<td>Beckett</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>George Abbot</td>
<td>Abbot</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Kia Abdullah</td>
<td>Abdullah</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Lascelles Abercrombie</td>
<td>Abercrombie</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Faridah Àbíké-Íyímídé</td>
<td>Íyímídé</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Paul Ableman</td>
<td>Ableman</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>J. R. Ackerley</td>
<td>Ackerley</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>Rodney Ackland</td>
<td>Ackland</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Now, how about the dates that each author was alive? We can look for four-digit numbers, which should correspond to years:</p>
<div id="54f3cca2" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract birth and death years</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Find all four-digit numbers (years)</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>years_pattern <span class="op">=</span> <span class="vs">r'</span><span class="kw">(</span><span class="pp">[0-9]</span><span class="op">{4}</span><span class="kw">)</span><span class="vs">'</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract first and last occurrence of four-digit numbers</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>wiki_sample[<span class="st">'birth_year'</span>] <span class="op">=</span> wiki_sample[<span class="st">'desc'</span>].<span class="bu">str</span>.extract(years_pattern, expand<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>wiki_sample[<span class="st">'death_year'</span>] <span class="op">=</span> wiki_sample[<span class="st">'desc'</span>].<span class="bu">str</span>.extractall(years_pattern).groupby(level<span class="op">=</span><span class="dv">0</span>)[<span class="dv">0</span>].last()</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Handle cases where birth and death years are the same</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>wiki_sample[<span class="st">'is_modern'</span>] <span class="op">=</span> wiki_sample[<span class="st">'death_year'</span>].<span class="bu">str</span>[:<span class="dv">2</span>].isin([<span class="st">'19'</span>, <span class="st">'20'</span>])</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>wiki_sample.loc[</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    (wiki_sample[<span class="st">'birth_year'</span>] <span class="op">==</span> wiki_sample[<span class="st">'death_year'</span>]) <span class="op">&amp;</span> </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    (<span class="op">~</span>wiki_sample[<span class="st">'is_modern'</span>]), <span class="st">'birth_year'</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>wiki_sample.loc[</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    (wiki_sample[<span class="st">'birth_year'</span>] <span class="op">==</span> wiki_sample[<span class="st">'death_year'</span>]) <span class="op">&amp;</span> </span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    (wiki_sample[<span class="st">'is_modern'</span>]), <span class="st">'death_year'</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>wiki_sample[[<span class="st">'author_name'</span>, <span class="st">'birth_year'</span>, <span class="st">'death_year'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">author_name</th>
<th data-quarto-table-cell-role="th">birth_year</th>
<th data-quarto-table-cell-role="th">death_year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>A. W.</td>
<td>None</td>
<td>1602</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Edwin Abbott Abbott</td>
<td>1838</td>
<td>1926</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Gilbert Abbott à Beckett</td>
<td>1811</td>
<td>1856</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>George Abbot</td>
<td>1562</td>
<td>1633</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Kia Abdullah</td>
<td>1982</td>
<td>None</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Lascelles Abercrombie</td>
<td>1881</td>
<td>1938</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Faridah Àbíké-Íyímídé</td>
<td>1998</td>
<td>None</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Paul Ableman</td>
<td>1927</td>
<td>2006</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>J. R. Ackerley</td>
<td>1896</td>
<td>1967</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>Rodney Ackland</td>
<td>1908</td>
<td>1991</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We can also extract all occurrences of a pattern using <code>findall</code>:</p>
<div id="0515186f" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract all vowels from each description</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>wiki_sample[<span class="st">'all_vowels'</span>] <span class="op">=</span> wiki_sample[<span class="st">'desc'</span>].<span class="bu">str</span>.findall(<span class="vs">r'</span><span class="pp">[AEIOUaeiou]</span><span class="vs">'</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>wiki_sample[[<span class="st">'author_name'</span>, <span class="st">'all_vowels'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">author_name</th>
<th data-quarto-table-cell-role="th">all_vowels</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>A. W.</td>
<td>[A, o, e]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Edwin Abbott Abbott</td>
<td>[E, i, A, o, A, o, e, o, o, i, a, a, o, e, i]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Gilbert Abbott à Beckett</td>
<td>[i, e, A, o, e, e, u, o, i]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>George Abbot</td>
<td>[e, o, e, A, o, i, e, A, a, a, o, a, e, i]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Kia Abdullah</td>
<td>[i, a, A, u, a, o, o, e, i, a, e, a, u, e, i, e]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Lascelles Abercrombie</td>
<td>[a, e, e, A, e, o, i, e, o, e, a, i, i]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Faridah Àbíké-Íyímídé</td>
<td>[a, i, a, o, o, e, i]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Paul Ableman</td>
<td>[a, u, A, e, a, a, i, a, o, e, i]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>J. R. Ackerley</td>
<td>[A, e, e, a, u, o, i, o, a, e, o, e, i, a, a, i]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>Rodney Ackland</td>
<td>[o, e, A, a, a, i, a, o, a, e, e, i, e]</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The output shows lists of vowels for each author. This type of structure is called <em>nested</em> data. We can “explode” these lists to create multiple rows per author:</p>
<div id="d894e3cd" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Explode the vowels to create multiple rows</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>vowels_exploded <span class="op">=</span> (wiki_sample[[<span class="st">'author_name'</span>, <span class="st">'all_vowels'</span>]]</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    .explode(<span class="st">'all_vowels'</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    .dropna()</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>vowels_exploded</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">author_name</th>
<th data-quarto-table-cell-role="th">all_vowels</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>A. W.</td>
<td>A</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>A. W.</td>
<td>o</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>A. W.</td>
<td>e</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Edwin Abbott Abbott</td>
<td>E</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>Edwin Abbott Abbott</td>
<td>i</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>Rodney Ackland</td>
<td>a</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>Rodney Ackland</td>
<td>e</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>Rodney Ackland</td>
<td>e</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>Rodney Ackland</td>
<td>i</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>Rodney Ackland</td>
<td>e</td>
</tr>
</tbody>
</table>

<p>117 rows × 2 columns</p>
</div>
</div>
</div>
<p>We can use similar techniques to extract professions. Let’s look for text after the closing parenthesis:</p>
<div id="badd9646" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>wiki_sample[<span class="st">'professions_raw'</span>] <span class="op">=</span> wiki_sample[<span class="st">'desc'</span>].<span class="bu">str</span>.extract(<span class="vs">r'</span><span class="ch">\)</span><span class="kw">(</span><span class="dv">.</span><span class="op">+</span><span class="kw">)</span><span class="dv">$</span><span class="vs">'</span>, expand<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>wiki_sample[<span class="st">'professions_clean'</span>] <span class="op">=</span> (wiki_sample[<span class="st">'professions_raw'</span>]</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">str</span>.strip()</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">str</span>.replace(<span class="st">' and '</span>, <span class="st">', '</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>wiki_sample[<span class="st">'professions'</span>] <span class="op">=</span> wiki_sample[<span class="st">'professions_clean'</span>].<span class="bu">str</span>.split(<span class="st">', '</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>wiki_prof <span class="op">=</span> (wiki_sample[[<span class="st">'author_name'</span>, <span class="st">'professions'</span>]]</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    .explode(<span class="st">'professions'</span>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    .dropna()</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    .reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>wiki_prof</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">author_name</th>
<th data-quarto-table-cell-role="th">professions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>A. W.</td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>A. W.</td>
<td>poet</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Edwin Abbott Abbott</td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Edwin Abbott Abbott</td>
<td>theologian</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Edwin Abbott Abbott</td>
<td>novelist</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Gilbert Abbott à Beckett</td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Gilbert Abbott à Beckett</td>
<td>humorist</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>George Abbot</td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>George Abbot</td>
<td>writer</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>George Abbot</td>
<td>AV translator</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>George Abbot</td>
<td>cleric</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>Kia Abdullah</td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>Kia Abdullah</td>
<td>novelist</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>Kia Abdullah</td>
<td>feature writer</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>Lascelles Abercrombie</td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>Lascelles Abercrombie</td>
<td>poet</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>Lascelles Abercrombie</td>
<td>critic</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>Faridah Àbíké-Íyímídé</td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>Faridah Àbíké-Íyímídé</td>
<td>novelist</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>Paul Ableman</td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>Paul Ableman</td>
<td>playwright</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>Paul Ableman</td>
<td>novelist</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>J. R. Ackerley</td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>J. R. Ackerley</td>
<td>autobiographer</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>J. R. Ackerley</td>
<td>novelist</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>J. R. Ackerley</td>
<td>playwright</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>Rodney Ackland</td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>Rodney Ackland</td>
<td>playwright</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>Rodney Ackland</td>
<td>actor</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>Rodney Ackland</td>
<td>screenwriter</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Let’s see the most common professions:</p>
<div id="8a81ea1e" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>profession_counts <span class="op">=</span> (wiki_prof</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">'professions'</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    .size()</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    .reset_index(name<span class="op">=</span><span class="st">'count'</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    .sort_values(<span class="st">'count'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>profession_counts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">professions</th>
<th data-quarto-table-cell-role="th">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td></td>
<td>10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>novelist</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>playwright</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>poet</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>AV translator</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>actor</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>autobiographer</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>cleric</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>critic</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>feature writer</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>humorist</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>screenwriter</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>theologian</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>writer</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>All of these top terms correspond to the professions we would expect from dataset of authors. While a full cleaning would require more sophisticated regular expressions to handle edge cases, our work illustrates the application of regular expression functions and how they can be used to extract data from raw strings. As we can see, getting data organized is a time consuming process and often the longest part of our humanities data work.</p>
</section>
<section id="json-data" class="level2" data-number="17.4">
<h2 data-number="17.4" class="anchored" data-anchor-id="json-data"><span class="header-section-number">17.4</span> JSON Data</h2>
<p>The <em>JavaScript Object Notation</em> (JSON) is a popular open standard data format. It was originally designed for the JavaScript language, but is supported in many programming languages. The format of JSON closely resembles native data structures found in Python. In part because of the importance of JavaScript as a core programming language in modern browsers, JSON has become a very popular format for data storage. This is particularly true for data that are distributed over a web-based API, as we will see later in this chapter.</p>
<p>As with CSV, JSON data is stored in a plaintext format. This means that we can open the file in any text editor and see the data in a human-readable format. We created a small example of a JSON file displaying information about two of the authors in our Wikipedia dataset:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"data"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"Charlotte Brontë"</span><span class="fu">,</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"age_at_death"</span><span class="fu">:</span> <span class="dv">38</span><span class="fu">,</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"date"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"born"</span><span class="fu">:</span> <span class="st">"21 April 1816"</span><span class="fu">,</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"died"</span><span class="fu">:</span> <span class="st">"31 March 1855"</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"profession"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"novelist"</span><span class="ot">,</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"poet"</span><span class="ot">,</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"governess"</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>      <span class="ot">]</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"Virginia Woolf"</span><span class="fu">,</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"age_at_death"</span><span class="fu">:</span> <span class="dv">59</span><span class="fu">,</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"date"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"born"</span><span class="fu">:</span> <span class="st">"25 January 1882"</span><span class="fu">,</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"died"</span><span class="fu">:</span> <span class="st">"28 March 1941"</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"profession"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">"novelist"</span><span class="ot">,</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">"essayist"</span><span class="ot">,</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">"critic"</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>      <span class="ot">]</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Data stored in the JSON format is highly structured. In some ways, the format is more strict than CSV files and is relatively easy to parse. Looking at the example above, we see many of the basic element types of JSON data. In fact, there are only six core data types available:</p>
<ol type="1">
<li>an empty value called <code>null</code></li>
<li>a <strong>number</strong></li>
<li>a <strong>string</strong></li>
<li>a <strong>Boolean</strong> value equal to <code>true</code> or <code>false</code></li>
<li>an <strong>object</strong> of named value pairs, with names equal to strings and values equal to any other data type</li>
<li>an ordered <strong>array</strong> of objects coming from any other type</li>
</ol>
<p>Objects are defined by curly braces and arrays are defined with square brackets. The reason that JSON can become complex even with these limited types is that, as in the example above, it is possible to created nested structures using the object and array types. To read a JSON object into Python, we can use the built-in <code>json</code> module:</p>
<div id="3603f332" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Read JSON file</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"data/author.json"</span>, <span class="st">"r"</span>) <span class="im">as</span> f:</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    obj_json <span class="op">=</span> json.load(f)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Type: </span><span class="sc">{</span><span class="bu">type</span>(obj_json)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Keys: </span><span class="sc">{</span><span class="bu">list</span>(obj_json.keys())<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Type: &lt;class 'dict'&gt;
Keys: ['data']</code></pre>
</div>
</div>
<p>The output object <code>obj_json</code> is a Python dictionary. In general, Python turns JSON arrays into lists and objects into dictionaries. Numbers, strings, and Boolean objects become the corresponding Python types. To create a structured dataset from the output, we can use standard Python dictionary and list operations:</p>
<div id="a083cffc" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract author names</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>names <span class="op">=</span> [author[<span class="st">'name'</span>] <span class="cf">for</span> author <span class="kw">in</span> obj_json[<span class="st">'data'</span>]]</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Author names: </span><span class="sc">{</span>names<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a DataFrame with author information</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>authors_data <span class="op">=</span> []</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> author <span class="kw">in</span> obj_json[<span class="st">'data'</span>]:</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    authors_data.append({</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'name'</span>: author[<span class="st">'name'</span>],</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'age_at_death'</span>: author[<span class="st">'age_at_death'</span>],</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'born'</span>: author[<span class="st">'date'</span>][<span class="st">'born'</span>],</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'died'</span>: author[<span class="st">'date'</span>][<span class="st">'died'</span>]</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>meta <span class="op">=</span> pd.DataFrame(authors_data)</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>meta</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Author names: ['Charlotte Brontë', 'Virginia Woolf']</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">age_at_death</th>
<th data-quarto-table-cell-role="th">born</th>
<th data-quarto-table-cell-role="th">died</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Charlotte Brontë</td>
<td>38</td>
<td>21 April 1816</td>
<td>31 March 1855</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Virginia Woolf</td>
<td>59</td>
<td>25 January 1882</td>
<td>28 March 1941</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The JSON object also associates each author with a set of professions. JSON naturally handles nested structures. To create a dataset mapping each author to all of their professions, we can use pandas’ explode functionality:</p>
<div id="59598f04" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create professions dataset</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>prof_data <span class="op">=</span> []</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> author <span class="kw">in</span> obj_json[<span class="st">'data'</span>]:</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    name <span class="op">=</span> author[<span class="st">'name'</span>]</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> profession <span class="kw">in</span> author[<span class="st">'profession'</span>]:</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>        prof_data.append({</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: name,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">'profession'</span>: profession</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>prof <span class="op">=</span> pd.DataFrame(prof_data)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(prof)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternative approach using pandas</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>authors_with_prof <span class="op">=</span> pd.DataFrame([</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">'name'</span>: author[<span class="st">'name'</span>],</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'profession'</span>: author[<span class="st">'profession'</span>]</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">for</span> author <span class="kw">in</span> obj_json[<span class="st">'data'</span>]</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Explode the professions</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>prof_alt <span class="op">=</span> authors_with_prof.explode(<span class="st">'profession'</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>prof_alt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               name profession
0  Charlotte Brontë   novelist
1  Charlotte Brontë       poet
2  Charlotte Brontë  governess
3    Virginia Woolf   novelist
4    Virginia Woolf   essayist
5    Virginia Woolf     critic</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">profession</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Charlotte Brontë</td>
<td>novelist</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Charlotte Brontë</td>
<td>poet</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Charlotte Brontë</td>
<td>governess</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Virginia Woolf</td>
<td>novelist</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Virginia Woolf</td>
<td>essayist</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Virginia Woolf</td>
<td>critic</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>It is often the case that one JSON file needs to be turned into multiple tabular datasets with different primary and foreign keys used to link them together. Deciding what tables to build and how to link them together is the core task of turning JSON data into tabular data. The difficulty of this varies greatly on the level of nesting in the JSON data as well as the consistency from record to record.</p>
</section>
<section id="xml-and-html-formats" class="level2" data-number="17.5">
<h2 data-number="17.5" class="anchored" data-anchor-id="xml-and-html-formats"><span class="header-section-number">17.5</span> XML and HTML Formats</h2>
<p><em>Extensible Markup Language</em> (XML) is another popular format for transferring and storing data. As with JSON data, the format is quite flexible and typically results in nested, tree-like structures that require some work to turn into a rectangular data format. Much of the formal standards for XML are concerned with describing how other groups can produce specific “extensible” dialects of XML that have consistent names and structures to describe particular kinds of data. Popular open examples include XML-RDF (Resource Description Framework) for describing linked open data and XML-TEI (Text Encoding Initiative) for providing context to textual data.</p>
<p>The XML format organizes data inside of hierarchically nested tags. Below is an example of how the data from the previous JSON example could have been stored in an XML dataset:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode xml code-with-copy"><code class="sourceCode xml"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">&lt;?xml</span><span class="ot"> version=</span><span class="st">"1.0"</span><span class="ot"> encoding=</span><span class="st">"UTF-8"</span><span class="fu">?&gt;</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">root</span>&gt;</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  &lt;<span class="kw">author</span>&gt;</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">name</span>&gt;Charlotte Brontë&lt;/<span class="kw">name</span>&gt;</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">life</span>&gt;</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">item</span><span class="ot"> name=</span><span class="st">"born"</span>&gt;21 April 1816&lt;/<span class="kw">item</span>&gt;</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">item</span><span class="ot"> name=</span><span class="st">"died"</span>&gt;31 March 1855&lt;/<span class="kw">item</span>&gt;</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">life</span>&gt;</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">ageatdeath</span>&gt;38&lt;/<span class="kw">ageatdeath</span>&gt;</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">professions</span>&gt;</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">profession</span>&gt;novelist&lt;/<span class="kw">profession</span>&gt;</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">profession</span>&gt;poet&lt;/<span class="kw">profession</span>&gt;</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">profession</span>&gt;governess&lt;/<span class="kw">profession</span>&gt;</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">professions</span>&gt;</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  &lt;/<span class="kw">author</span>&gt;</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  &lt;<span class="kw">author</span>&gt;</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">name</span>&gt;Virginia Woolf&lt;/<span class="kw">name</span>&gt;</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">life</span>&gt;</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">item</span><span class="ot"> name=</span><span class="st">"born"</span>&gt;25 January 1882&lt;/<span class="kw">item</span>&gt;</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">item</span><span class="ot"> name=</span><span class="st">"died"</span>&gt;28 March 1941&lt;/<span class="kw">item</span>&gt;</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">life</span>&gt;</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">ageatdeath</span>&gt;59&lt;/<span class="kw">ageatdeath</span>&gt;</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">professions</span>&gt;</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">profession</span>&gt;novelist&lt;/<span class="kw">profession</span>&gt;</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">profession</span>&gt;essayist&lt;/<span class="kw">profession</span>&gt;</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">profession</span>&gt;critic&lt;/<span class="kw">profession</span>&gt;</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">professions</span>&gt;</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>  &lt;/<span class="kw">author</span>&gt;</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">root</span>&gt;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Python provides several ways to parse XML. We can use the built-in <code>xml.etree.ElementTree</code> module or the more powerful <code>lxml</code> library:</p>
<div id="b7eaf772" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xml.etree.ElementTree <span class="im">as</span> ET</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse XML file</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>tree <span class="op">=</span> ET.parse(<span class="st">"data/author.xml"</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>root <span class="op">=</span> tree.getroot()</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Root tag: </span><span class="sc">{</span>root<span class="sc">.</span>tag<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of authors: </span><span class="sc">{</span><span class="bu">len</span>(root.findall(<span class="st">'author'</span>))<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Root tag: root
Number of authors: 2</code></pre>
</div>
</div>
<p>We can extract data from XML by navigating the tree structure:</p>
<div id="2c7e66e7" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract author information</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>authors_xml <span class="op">=</span> []</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> author <span class="kw">in</span> root.findall(<span class="st">'author'</span>):</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    name <span class="op">=</span> author.find(<span class="st">'name'</span>).text</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    age <span class="op">=</span> <span class="bu">int</span>(author.find(<span class="st">'ageatdeath'</span>).text)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract birth and death dates</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    life <span class="op">=</span> author.find(<span class="st">'life'</span>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    born <span class="op">=</span> life.find(<span class="st">"item[@name='born']"</span>).text</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    died <span class="op">=</span> life.find(<span class="st">"item[@name='died']"</span>).text</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    authors_xml.append({</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'name'</span>: name,</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'age_at_death'</span>: age,</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'born'</span>: born,</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">'died'</span>: died</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>meta_xml <span class="op">=</span> pd.DataFrame(authors_xml)</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>meta_xml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">age_at_death</th>
<th data-quarto-table-cell-role="th">born</th>
<th data-quarto-table-cell-role="th">died</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Charlotte Brontë</td>
<td>38</td>
<td>21 April 1816</td>
<td>31 March 1855</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Virginia Woolf</td>
<td>59</td>
<td>25 January 1882</td>
<td>28 March 1941</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>For professions, we need to handle multiple elements:</p>
<div id="cd28f0de" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract professions</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>prof_xml <span class="op">=</span> []</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> author <span class="kw">in</span> root.findall(<span class="st">'author'</span>):</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    name <span class="op">=</span> author.find(<span class="st">'name'</span>).text</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    professions <span class="op">=</span> author.find(<span class="st">'professions'</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> prof <span class="kw">in</span> professions.findall(<span class="st">'profession'</span>):</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>        prof_xml.append({</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: name,</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">'profession'</span>: prof.text</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>prof_xml_df <span class="op">=</span> pd.DataFrame(prof_xml)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>prof_xml_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">profession</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Charlotte Brontë</td>
<td>novelist</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Charlotte Brontë</td>
<td>poet</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Charlotte Brontë</td>
<td>governess</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Virginia Woolf</td>
<td>novelist</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Virginia Woolf</td>
<td>essayist</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Virginia Woolf</td>
<td>critic</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>HTML (HyperText Markup Language)</strong> is a markup language for describing documents intended to be shown in a web browser. While its primary purpose is not to store arbitrary data, we often need to extract data from HTML documents. Here’s an example HTML file with the same author information:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;!DOCTYPE</span> html<span class="dt">&gt;</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="ot"> lang</span><span class="op">=</span><span class="st">"en"</span><span class="dt">&gt;</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">title</span><span class="dt">&gt;</span>British Authors<span class="dt">&lt;/</span><span class="kw">title</span><span class="dt">&gt;</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">h1</span><span class="dt">&gt;</span>British Authors<span class="dt">&lt;/</span><span class="kw">h1</span><span class="dt">&gt;</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">"author"</span><span class="dt">&gt;</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">h1</span><span class="dt">&gt;</span>Charlotte Brontë<span class="dt">&lt;/</span><span class="kw">h1</span><span class="dt">&gt;</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> id</span><span class="op">=</span><span class="st">"life"</span><span class="ot"> class</span><span class="op">=</span><span class="st">"info"</span><span class="dt">&gt;</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">p</span><span class="dt">&gt;</span>Lived from <span class="dt">&lt;</span><span class="kw">b</span><span class="ot"> id</span><span class="op">=</span><span class="st">"born"</span><span class="dt">&gt;</span>21 April 1816<span class="dt">&lt;/</span><span class="kw">b</span><span class="dt">&gt;</span> to <span class="dt">&lt;</span><span class="kw">b</span><span class="ot"> id</span><span class="op">=</span><span class="st">"died"</span><span class="dt">&gt;</span>31 March 1855<span class="dt">&lt;/</span><span class="kw">b</span><span class="dt">&gt;</span>.<span class="dt">&lt;/</span><span class="kw">p</span><span class="dt">&gt;</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> id</span><span class="op">=</span><span class="st">"profession"</span><span class="ot"> class</span><span class="op">=</span><span class="st">"info box"</span><span class="dt">&gt;</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">ul</span><span class="dt">&gt;</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;</span><span class="kw">li</span><span class="dt">&gt;&lt;</span><span class="kw">i</span><span class="dt">&gt;</span>novelist<span class="dt">&lt;/</span><span class="kw">i</span><span class="dt">&gt;&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;</span><span class="kw">li</span><span class="dt">&gt;&lt;</span><span class="kw">i</span><span class="dt">&gt;</span>poet<span class="dt">&lt;/</span><span class="kw">i</span><span class="dt">&gt;&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;</span><span class="kw">li</span><span class="dt">&gt;&lt;</span><span class="kw">i</span><span class="dt">&gt;</span>governess<span class="dt">&lt;/</span><span class="kw">i</span><span class="dt">&gt;&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;/</span><span class="kw">ul</span><span class="dt">&gt;</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">&lt;!-- Similar structure for Virginia Woolf --&gt;</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>For HTML parsing, <strong>BeautifulSoup</strong> is the most popular Python library:</p>
<div id="0b49e57d" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse HTML file</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"data/author.html"</span>, <span class="st">"r"</span>, encoding<span class="op">=</span><span class="st">"utf-8"</span>) <span class="im">as</span> f:</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    html_content <span class="op">=</span> f.read()</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>soup <span class="op">=</span> BeautifulSoup(html_content, <span class="st">'html.parser'</span>)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Title: </span><span class="sc">{</span>soup<span class="sc">.</span>title<span class="sc">.</span>text<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of author divs: </span><span class="sc">{</span><span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'author'</span>))<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Title: British Authors
Number of author divs: 2</code></pre>
</div>
</div>
<div id="fig-htmlauthor" class="lightbox quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-htmlauthor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="img/html_author_output.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Figure&nbsp;17.1: Example display of the British authors HTML file shown in Firefox."><img src="img/html_author_output.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-htmlauthor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;17.1: Example display of the British authors HTML file shown in Firefox.
</figcaption>
</figure>
</div>
<p>We can extract information using BeautifulSoup’s methods:</p>
<div id="817d746d" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract author information from HTML</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>authors_html <span class="op">=</span> []</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> author_div <span class="kw">in</span> soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'author'</span>):</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get author name from h1 tag</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    name <span class="op">=</span> author_div.find(<span class="st">'h1'</span>).text</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get birth and death dates</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    life_div <span class="op">=</span> author_div.find(<span class="st">'div'</span>, <span class="bu">id</span><span class="op">=</span><span class="st">'life'</span>)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    born <span class="op">=</span> life_div.find(<span class="st">'b'</span>, <span class="bu">id</span><span class="op">=</span><span class="st">'born'</span>).text</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    died <span class="op">=</span> life_div.find(<span class="st">'b'</span>, <span class="bu">id</span><span class="op">=</span><span class="st">'died'</span>).text</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    authors_html.append({</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'name'</span>: name,</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'born'</span>: born,</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">'died'</span>: died</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>meta_html <span class="op">=</span> pd.DataFrame(authors_html)</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(meta_html)</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract professions</span></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>prof_html <span class="op">=</span> []</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> author_div <span class="kw">in</span> soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'author'</span>):</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>    name <span class="op">=</span> author_div.find(<span class="st">'h1'</span>).text</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find profession list</span></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>    prof_ul <span class="op">=</span> author_div.find(<span class="st">'div'</span>, <span class="bu">id</span><span class="op">=</span><span class="st">'profession'</span>).find(<span class="st">'ul'</span>)</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> li <span class="kw">in</span> prof_ul.find_all(<span class="st">'li'</span>):</span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>        profession <span class="op">=</span> li.find(<span class="st">'i'</span>).text</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>        prof_html.append({</span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: name,</span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>            <span class="st">'profession'</span>: profession</span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>prof_html_df <span class="op">=</span> pd.DataFrame(prof_html)</span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>prof_html_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               name             born           died
0  Charlotte Brontë    21 April 1816  31 March 1855
1    Virginia Woolf  25 January 1882  28 March 1941</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">profession</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Charlotte Brontë</td>
<td>novelist</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Charlotte Brontë</td>
<td>poet</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Charlotte Brontë</td>
<td>governess</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Virginia Woolf</td>
<td>novelist</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Virginia Woolf</td>
<td>essayist</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Virginia Woolf</td>
<td>critic</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="xpath-with-lxml" class="level2" data-number="17.6">
<h2 data-number="17.6" class="anchored" data-anchor-id="xpath-with-lxml"><span class="header-section-number">17.6</span> XPath with lxml</h2>
<p>For more complex XML/HTML parsing, we can use XPath expressions with the <code>lxml</code> library. XPath is a powerful query language for XML documents:</p>
<div id="49651947" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lxml <span class="im">import</span> html, etree</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse HTML with lxml</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"data/author.html"</span>, <span class="st">"r"</span>, encoding<span class="op">=</span><span class="st">"utf-8"</span>) <span class="im">as</span> f:</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    html_content <span class="op">=</span> f.read()</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>doc <span class="op">=</span> html.fromstring(html_content)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co"># XPath examples</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Find all bold tags</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>bold_texts <span class="op">=</span> doc.xpath(<span class="st">".//b/text()"</span>)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Bold texts: </span><span class="sc">{</span>bold_texts<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Find all list items in profession divs</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>prof_items <span class="op">=</span> doc.xpath(<span class="st">".//div[@id='profession']//li/i/text()"</span>)</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Professions: </span><span class="sc">{</span>prof_items<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Find birth dates specifically</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>birth_dates <span class="op">=</span> doc.xpath(<span class="st">".//b[@id='born']/text()"</span>)</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Birth dates: </span><span class="sc">{</span>birth_dates<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Bold texts: ['21 April 1816', '31 March 1855', '25 January 1882', '28 March 1941']
Professions: ['novelist', 'poet', 'governess', 'novelist', 'essayist', 'critic']
Birth dates: ['21 April 1816', '25 January 1882']</code></pre>
</div>
</div>
<p>XPath provides very precise control over element selection:</p>
<div id="d95a8cab" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># More complex XPath queries</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Find all author names (h1 tags within author divs)</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>author_names <span class="op">=</span> doc.xpath(<span class="st">".//div[@class='author']/h1/text()"</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Author names: </span><span class="sc">{</span>author_names<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Find elements containing specific text</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>life_divs <span class="op">=</span> doc.xpath(<span class="st">".//div[contains(@class, 'info')]"</span>)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of info divs: </span><span class="sc">{</span><span class="bu">len</span>(life_divs)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine XPath with iteration</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, author_div <span class="kw">in</span> <span class="bu">enumerate</span>(doc.xpath(<span class="st">".//div[@class='author']"</span>)):</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    name <span class="op">=</span> author_div.xpath(<span class="st">"./h1/text()"</span>)[<span class="dv">0</span>]</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    born <span class="op">=</span> author_div.xpath(<span class="st">".//b[@id='born']/text()"</span>)[<span class="dv">0</span>]</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Author </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss"> (born </span><span class="sc">{</span>born<span class="sc">}</span><span class="ss">)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Author names: ['Charlotte Brontë', 'Virginia Woolf']
Number of info divs: 4
Author 1: Charlotte Brontë (born 21 April 1816)
Author 2: Virginia Woolf (born 25 January 1882)</code></pre>
</div>
</div>
</section>
<section id="using-an-api" class="level2" data-number="17.7">
<h2 data-number="17.7" class="anchored" data-anchor-id="using-an-api"><span class="header-section-number">17.7</span> Using an API</h2>
<p>An <em>application programming interface</em> (API) is a generic term for a specific interface that two computers can communicate across. Most commonly, APIs communicate over the internet using the <em>Hypertext Transfer Protocol</em> (HTTP). HTTP is a set of standards describing how different computers can communicate with one another over the internet. It is how the vast majority of the internet communicates; for example, our web browser uses HTTP to communicate with other websites.</p>
<p>There are many APIs available online for accessing a variety of different types of data. Often these require first setting up an account with the service. Some APIs require payment for each request, though others offer free access or a free-tier of access for occasional users. Most frequently, data from an API would correspond to some data source which is frequently changing, such as news stories or the weather. Increasingly, though, even static datasets are being put behind an API access rather than allowing a straightforward download of a CSV, JSON, or XML file. Fortunately, it is relatively easy to make and parse API calls from within Python using the <strong>requests</strong> library.</p>
<p>We will show two types of API calls that can be made with the MediaWiki API that runs behind Wikipedia. This API is particularly nice because not only is it freely available, it does not require any signup or access to run. Anyone can call the API directly and get data related to the various MediaWiki projects:</p>
<div id="5a91c247" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> urllib.parse <span class="im">import</span> urlencode</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Build API URL for Wikipedia pageviews</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>base_url <span class="op">=</span> <span class="st">"https://en.wikipedia.org/w/api.php"</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'action'</span>: <span class="st">'query'</span>,</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'format'</span>: <span class="st">'json'</span>,</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'prop'</span>: <span class="st">'pageviews'</span>,</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'titles'</span>: <span class="st">'Emily Brontë'</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the API request</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(base_url, params<span class="op">=</span>params)</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Status code: </span><span class="sc">{</span>response<span class="sc">.</span>status_code<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"URL: </span><span class="sc">{</span>response<span class="sc">.</span>url<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Status code: 200
URL: https://en.wikipedia.org/w/api.php?action=query&amp;format=json&amp;prop=pageviews&amp;titles=Emily+Bront%C3%AB</code></pre>
</div>
</div>
<p>Parse the JSON response:</p>
<div id="87f956f3" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse JSON response</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> response.json()</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract pageview data</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>pages <span class="op">=</span> data[<span class="st">'query'</span>][<span class="st">'pages'</span>]</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>page_id <span class="op">=</span> <span class="bu">list</span>(pages.keys())[<span class="dv">0</span>]</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>pageviews <span class="op">=</span> pages[page_id].get(<span class="st">'pageviews'</span>, {})</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to DataFrame</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> pageviews:</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    pageview_data <span class="op">=</span> []</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> date, views <span class="kw">in</span> pageviews.items():</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>        pageview_data.append({</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">'date'</span>: date,</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">'views'</span>: views,</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">'doc_id'</span>: <span class="st">'Emily Brontë'</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>    page_views_df <span class="op">=</span> pd.DataFrame(pageview_data)</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(page_views_df.head())</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"No pageview data available"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         date  views        doc_id
0  2025-05-30   1552  Emily Brontë
1  2025-05-31   1784  Emily Brontë
2  2025-06-01   1881  Emily Brontë
3  2025-06-02   1677  Emily Brontë
4  2025-06-03   1643  Emily Brontë</code></pre>
</div>
</div>
<p>We can create a function to get pageviews for multiple authors:</p>
<div id="c43a69f6" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_pageviews(titles_list, max_requests<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Get pageviews for a list of Wikipedia page titles."""</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    all_pageviews <span class="op">=</span> []</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, title <span class="kw">in</span> <span class="bu">enumerate</span>(titles_list[:max_requests]):  <span class="co"># Limit for demo</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>        params <span class="op">=</span> {</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">'action'</span>: <span class="st">'query'</span>,</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">'format'</span>: <span class="st">'json'</span>,</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">'prop'</span>: <span class="st">'pageviews'</span>,</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">'titles'</span>: title</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> requests.get(base_url, params<span class="op">=</span>params)</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>            data <span class="op">=</span> response.json()</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>            pages <span class="op">=</span> data[<span class="st">'query'</span>][<span class="st">'pages'</span>]</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>            page_id <span class="op">=</span> <span class="bu">list</span>(pages.keys())[<span class="dv">0</span>]</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>            pageviews <span class="op">=</span> pages[page_id].get(<span class="st">'pageviews'</span>, {})</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> date, views <span class="kw">in</span> pageviews.items():</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>                all_pageviews.append({</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'doc_id'</span>: title,</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'date'</span>: date,</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'views'</span>: views</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>                })</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Error fetching data for </span><span class="sc">{</span>title<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame(all_pageviews)</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Test with a few authors</span></span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>authors <span class="op">=</span> [<span class="st">'Emily Brontë'</span>, <span class="st">'Charlotte Brontë'</span>, <span class="st">'Virginia Woolf'</span>]</span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>pageviews_df <span class="op">=</span> get_pageviews(authors)</span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a>pageviews_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">doc_id</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">views</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Emily Brontë</td>
<td>2025-05-30</td>
<td>1552</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Emily Brontë</td>
<td>2025-05-31</td>
<td>1784</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Emily Brontë</td>
<td>2025-06-01</td>
<td>1881</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Emily Brontë</td>
<td>2025-06-02</td>
<td>1677</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Emily Brontë</td>
<td>2025-06-03</td>
<td>1643</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">175</td>
<td>Virginia Woolf</td>
<td>2025-07-24</td>
<td>3074</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">176</td>
<td>Virginia Woolf</td>
<td>2025-07-25</td>
<td>2824</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">177</td>
<td>Virginia Woolf</td>
<td>2025-07-26</td>
<td>3114</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">178</td>
<td>Virginia Woolf</td>
<td>2025-07-27</td>
<td>3235</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">179</td>
<td>Virginia Woolf</td>
<td>2025-07-28</td>
<td>3129</td>
</tr>
</tbody>
</table>

<p>180 rows × 3 columns</p>
</div>
</div>
</div>
<p>We can also get the actual page content using a different API endpoint:</p>
<div id="160efa0b" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get page content</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_page_content(title):</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Get the HTML content of a Wikipedia page."""</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> {</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">'action'</span>: <span class="st">'parse'</span>,</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'format'</span>: <span class="st">'json'</span>,</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'page'</span>: title,</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'redirects'</span>: <span class="va">True</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> requests.get(base_url, params<span class="op">=</span>params)</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> response.json()</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'parse'</span> <span class="kw">in</span> data:</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>        html_content <span class="op">=</span> data[<span class="st">'parse'</span>][<span class="st">'text'</span>][<span class="st">'*'</span>]</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> html_content</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Get content for Emily Brontë</span></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>emily_html <span class="op">=</span> get_page_content(<span class="st">'Emily Brontë'</span>)</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> emily_html:</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Parse with BeautifulSoup</span></span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>    soup <span class="op">=</span> BeautifulSoup(emily_html, <span class="st">'html.parser'</span>)</span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract paragraphs</span></span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>    paragraphs <span class="op">=</span> soup.find_all(<span class="st">'p'</span>)</span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Found </span><span class="sc">{</span><span class="bu">len</span>(paragraphs)<span class="sc">}</span><span class="ss"> paragraphs"</span>)</span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Show first paragraph</span></span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> paragraphs:</span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"First paragraph: </span><span class="sc">{</span>paragraphs[<span class="dv">0</span>]<span class="sc">.</span>get_text()[:<span class="dv">200</span>]<span class="sc">}</span><span class="ss">..."</span>)</span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract links</span></span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a>    links <span class="op">=</span> soup.find_all(<span class="st">'a'</span>, href<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a>    wiki_links <span class="op">=</span> [link[<span class="st">'href'</span>] <span class="cf">for</span> link <span class="kw">in</span> links <span class="cf">if</span> link[<span class="st">'href'</span>].startswith(<span class="st">'/wiki/'</span>)]</span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Found </span><span class="sc">{</span><span class="bu">len</span>(wiki_links)<span class="sc">}</span><span class="ss"> internal Wikipedia links"</span>)</span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"First 10 links:"</span>)</span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> link <span class="kw">in</span> wiki_links[:<span class="dv">10</span>]:</span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>link<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Found 45 paragraphs
First paragraph: 
...

Found 383 internal Wikipedia links
First 10 links:
  /wiki/File:Emily_Bront%C3%AB_by_Patrick_Branwell_Bront%C3%AB_restored.jpg
  /wiki/Branwell_Bront%C3%AB
  /wiki/Thornton,_West_Yorkshire
  /wiki/Haworth
  /wiki/St_Michael_and_All_Angels%27_Church,_Haworth
  /wiki/Governess
  /wiki/Cowan_Bridge_School
  /wiki/Romantic_Period
  /wiki/Wuthering_Heights
  /wiki/Patrick_Bront%C3%AB</code></pre>
</div>
</div>
<p>This approach allows us to recreate the datasets used throughout Chaps. 6-8. The specific query parameters for different APIs will vary, but the general pattern remains the same: construct the API URL, make the request, parse the response (usually JSON), and convert to a structured format.</p>
<div id="614ada5f" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example of building a larger dataset</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_author_dataset(author_list, get_content<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Build a comprehensive dataset of author information."""</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    dataset <span class="op">=</span> []</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> author <span class="kw">in</span> author_list[:<span class="dv">3</span>]:  <span class="co"># Limit for demo</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Processing </span><span class="sc">{</span>author<span class="sc">}</span><span class="ss">..."</span>)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get pageviews</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>        pageviews <span class="op">=</span> get_pageviews([author], max_requests<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get content if requested</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>        content <span class="op">=</span> <span class="va">None</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> get_content:</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>            content <span class="op">=</span> get_page_content(author)</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>        dataset.append({</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">'author'</span>: author,</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">'pageviews'</span>: pageviews,</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">'content'</span>: content</span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> dataset</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Build dataset</span></span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>authors <span class="op">=</span> [<span class="st">'Emily Brontë'</span>, <span class="st">'Charlotte Brontë'</span>, <span class="st">'Virginia Woolf'</span>]</span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>author_data <span class="op">=</span> build_author_dataset(authors, get_content<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Built dataset for </span><span class="sc">{</span><span class="bu">len</span>(author_data)<span class="sc">}</span><span class="ss"> authors"</span>)</span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, author_info <span class="kw">in</span> <span class="bu">enumerate</span>(author_data):</span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Author </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>author_info[<span class="st">'author'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Pageviews records: </span><span class="sc">{</span><span class="bu">len</span>(author_info[<span class="st">'pageviews'</span>])<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Has content: </span><span class="sc">{</span>author_info[<span class="st">'content'</span>] <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span><span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Processing Emily Brontë...
Processing Charlotte Brontë...
Processing Virginia Woolf...
Built dataset for 3 authors
Author 1: Emily Brontë
  Pageviews records: 60
  Has content: True
Author 2: Charlotte Brontë
  Pageviews records: 60
  Has content: True
Author 3: Virginia Woolf
  Pageviews records: 60
  Has content: True</code></pre>
</div>
</div>
</section>
<section id="extensions" class="level2" data-number="17.8">
<h2 data-number="17.8" class="anchored" data-anchor-id="extensions"><span class="header-section-number">17.8</span> Extensions</h2>
<p>There is a lot of information covered in this chapter and many different directions that the material can be extended and built upon. Python provides excellent built-in support for regular expressions through the <strong>re</strong> module, and there are many more advanced pattern matching techniques worth learning <span class="citation" data-cites="goyvaerts2012regular">[<a href="#ref-goyvaerts2012regular" role="doc-biblioref">4</a>]</span>.</p>
<p><strong>For string processing:</strong> - The <strong>re</strong> module has many more functions like <code>re.finditer()</code> for finding all matches with positions - <strong>pandas</strong> string methods provide vectorized string operations - Libraries like <strong>fuzzywuzzy</strong> for fuzzy string matching</p>
<p><strong>For JSON processing:</strong> - Python’s built-in <strong>json</strong> module handles most use cases - <strong>jsonschema</strong> for validating JSON structure - <strong>pandas.json_normalize()</strong> for flattening nested JSON</p>
<p><strong>For XML/HTML processing:</strong> - <strong>lxml</strong> provides the most complete XPath support - <strong>BeautifulSoup</strong> is excellent for HTML parsing and has a gentle learning curve - <strong>html5lib</strong> for parsing real-world HTML that may not be well-formed - <strong>requests-html</strong> combines requests with PyQuery for JavaScript-heavy sites</p>
<p><strong>For API interaction:</strong> - <strong>requests</strong> is the standard library for HTTP requests - <strong>httpx</strong> for async HTTP requests - <strong>requests-cache</strong> for caching API responses - Authentication libraries for OAuth, API keys, etc.</p>
<p>Many resources exist for extending these methods. The <strong>requests</strong> documentation (docs.python-requests.org) is excellent for API work. For XML/HTML processing, the BeautifulSoup documentation (beautiful-soup-4.readthedocs.io) and lxml documentation provide comprehensive guides. When combined with the practical information in this chapter, these resources should enable you to work with almost any text-based data format or web API.</p>
<p>The benefits of Python’s rich ecosystem make it possible to handle complex data extraction tasks efficiently. Libraries like <strong>scrapy</strong> for large-scale web scraping, <strong>selenium</strong> for JavaScript-heavy sites, and <strong>pandas</strong> for data manipulation provide a complete toolkit for gathering and organizing humanities data from diverse sources.</p>
<p>As we’ve seen throughout this chapter, collecting and organizing data is time consuming and often requires careful attention to detail. However, the tools and techniques covered here provide a solid foundation for working with the wide variety of data formats encountered in digital humanities research.</p>
</section>
<section id="references" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="references">References</h2>


<div id="refs" class="references csl-bib-body" role="list">
<div id="ref-haven" class="csl-entry" role="listitem">
<div class="csl-left-margin">[1] </div><div class="csl-right-inline">Wickham, H, Miller, E and Smith, D (2023 ). <em>Haven: Import and Export ’SPSS’, ’Stata’ and ’SAS’ Files</em>. <a href="https://CRAN.R-project.org/package=haven">https://CRAN.R-project.org/package=haven</a></div>
</div>
<div id="ref-duckdb" class="csl-entry" role="listitem">
<div class="csl-left-margin">[2] </div><div class="csl-right-inline">Mühleisen, H and Raasveldt, M (2023 ). <em>Duckdb: DBI Package for the DuckDB Database Management System</em>. <a href="https://CRAN.R-project.org/package=duckdb">https://CRAN.R-project.org/package=duckdb</a></div>
</div>
<div id="ref-RMySQL" class="csl-entry" role="listitem">
<div class="csl-left-margin">[3] </div><div class="csl-right-inline">Ooms, J, James, D, DebRoy, S, Wickham, H and Horner, J (2023 ). <em>RMySQL: Database Interface and ’MySQL’ Driver for r</em>. <a href="https://CRAN.R-project.org/package=RMySQL">https://CRAN.R-project.org/package=RMySQL</a></div>
</div>
<div id="ref-goyvaerts2012regular" class="csl-entry" role="listitem">
<div class="csl-left-margin">[4] </div><div class="csl-right-inline">Goyvaerts, J and Levithan, S (2012 ). <em>Regular Expressions Cookbook</em>. O’reilly</div>
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/distant-viewing\.github\.io\/hdpy");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./16_program.html" class="pagination-link" aria-label="Programming">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Programming</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./18_databases.html" class="pagination-link" aria-label="Databases">
        <span class="nav-page-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Databases</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Taylor Arnold and Lauren Tilton</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>A <a href="https://distantviewing.org/">Distant Viewing Lab</a> project</p>
</div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>